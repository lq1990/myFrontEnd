var cov_ete167hvl=function(){var path="D:\\myGithub\\myFrontEnd\\NodeJS\\express_crud\\service\\userService.js",hash="3dfc9034ae6d1cc91096688ae4183421252490d6",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"D:\\myGithub\\myFrontEnd\\NodeJS\\express_crud\\service\\userService.js",statementMap:{"0":{start:{line:10,column:15},end:{line:10,column:36}},"1":{start:{line:11,column:11},end:{line:11,column:24}},"2":{start:{line:12,column:13},end:{line:12,column:28}},"3":{start:{line:15,column:0},end:{line:17,column:2}},"4":{start:{line:16,column:4},end:{line:16,column:24}},"5":{start:{line:20,column:0},end:{line:41,column:2}},"6":{start:{line:22,column:4},end:{line:27,column:5}},"7":{start:{line:23,column:8},end:{line:26,column:9}},"8":{start:{line:28,column:4},end:{line:33,column:5}},"9":{start:{line:29,column:8},end:{line:32,column:9}},"10":{start:{line:35,column:4},end:{line:39,column:6}},"11":{start:{line:44,column:0},end:{line:63,column:2}},"12":{start:{line:46,column:4},end:{line:51,column:5}},"13":{start:{line:47,column:8},end:{line:50,column:9}},"14":{start:{line:54,column:20},end:{line:54,column:59}},"15":{start:{line:55,column:4},end:{line:55,column:31}},"16":{start:{line:57,column:4},end:{line:57,column:22}},"17":{start:{line:59,column:4},end:{line:62,column:5}},"18":{start:{line:67,column:20},end:{line:67,column:44}},"19":{start:{line:68,column:4},end:{line:70,column:7}},"20":{start:{line:73,column:0},end:{line:92,column:1}},"21":{start:{line:74,column:4},end:{line:74,column:40}},"22":{start:{line:76,column:4},end:{line:86,column:5}},"23":{start:{line:77,column:20},end:{line:77,column:59}},"24":{start:{line:77,column:48},end:{line:77,column:58}},"25":{start:{line:78,column:8},end:{line:78,column:38}},"26":{start:{line:80,column:8},end:{line:80,column:36}},"27":{start:{line:81,column:8},end:{line:81,column:26}},"28":{start:{line:82,column:8},end:{line:85,column:9}},"29":{start:{line:88,column:4},end:{line:91,column:5}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:15,column:19},end:{line:15,column:20}},loc:{start:{line:15,column:31},end:{line:17,column:1}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:23},end:{line:20,column:24}},loc:{start:{line:20,column:45},end:{line:41,column:1}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:44,column:18},end:{line:44,column:19}},loc:{start:{line:44,column:34},end:{line:63,column:1}},line:44},"3":{name:"_savejson",decl:{start:{line:66,column:9},end:{line:66,column:18}},loc:{start:{line:66,column:29},end:{line:71,column:1}},line:66},"4":{name:"(anonymous_4)",decl:{start:{line:73,column:18},end:{line:73,column:19}},loc:{start:{line:73,column:32},end:{line:92,column:1}},line:73},"5":{name:"(anonymous_5)",decl:{start:{line:77,column:43},end:{line:77,column:44}},loc:{start:{line:77,column:48},end:{line:77,column:58}},line:77}},branchMap:{"0":{loc:{start:{line:22,column:4},end:{line:27,column:5}},type:"if",locations:[{start:{line:22,column:4},end:{line:27,column:5}},{start:{line:22,column:4},end:{line:27,column:5}}],line:22},"1":{loc:{start:{line:22,column:8},end:{line:22,column:47}},type:"binary-expr",locations:[{start:{line:22,column:8},end:{line:22,column:34}},{start:{line:22,column:38},end:{line:22,column:47}}],line:22},"2":{loc:{start:{line:28,column:4},end:{line:33,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:33,column:5}},{start:{line:28,column:4},end:{line:33,column:5}}],line:28},"3":{loc:{start:{line:28,column:8},end:{line:28,column:47}},type:"binary-expr",locations:[{start:{line:28,column:8},end:{line:28,column:34}},{start:{line:28,column:38},end:{line:28,column:47}}],line:28},"4":{loc:{start:{line:46,column:4},end:{line:51,column:5}},type:"if",locations:[{start:{line:46,column:4},end:{line:51,column:5}},{start:{line:46,column:4},end:{line:51,column:5}}],line:46},"5":{loc:{start:{line:76,column:4},end:{line:86,column:5}},type:"if",locations:[{start:{line:76,column:4},end:{line:86,column:5}},{start:{line:76,column:4},end:{line:86,column:5}}],line:76},"6":{loc:{start:{line:76,column:8},end:{line:76,column:41}},type:"binary-expr",locations:[{start:{line:76,column:8},end:{line:76,column:14}},{start:{line:76,column:18},end:{line:76,column:41}}],line:76}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();/*
 * 对读取和操作用户数据的服务封装
 *
 * 
 * 
 *  
 */ // 加载json文件模块
const dbjson=(cov_ete167hvl.s[0]++,require("../db.json"));const fs=(cov_ete167hvl.s[1]++,require("fs"));const path=(cov_ete167hvl.s[2]++,require("path"));// 获取所有的用户数据
cov_ete167hvl.s[3]++;exports.getUsers=function(){cov_ete167hvl.f[0]++;cov_ete167hvl.s[4]++;return dbjson.users;};// page: 第几页， size：一页多少条
cov_ete167hvl.s[5]++;exports.getPageUsers=function(page,size){cov_ete167hvl.f[1]++;cov_ete167hvl.s[6]++;// page, size: int 
if((cov_ete167hvl.b[1][0]++,typeof page!=="number")||(cov_ete167hvl.b[1][1]++,page<=0)){cov_ete167hvl.b[0][0]++;cov_ete167hvl.s[7]++;return{code:0,msg:"type or size of page is invalid."};}else{cov_ete167hvl.b[0][1]++;};cov_ete167hvl.s[8]++;if((cov_ete167hvl.b[3][0]++,typeof size!=="number")||(cov_ete167hvl.b[3][1]++,size<=0)){cov_ete167hvl.b[2][0]++;cov_ete167hvl.s[9]++;return{code:0,msg:"type or size of size is invalid."};}else{cov_ete167hvl.b[2][1]++;};cov_ete167hvl.s[10]++;return{users:dbjson.users.slice((page-1)*size,page*size),code:1,msg:"success"};};// 把数据放到db.json文件中
cov_ete167hvl.s[11]++;exports.addUser=function(user){cov_ete167hvl.f[2]++;cov_ete167hvl.s[12]++;// 判断user对象的输几局是否合法
if(!user.name){cov_ete167hvl.b[4][0]++;cov_ete167hvl.s[13]++;return{msg:"username cannot be empty.",code:0};}else{cov_ete167hvl.b[4][1]++;}// user.id // 自动复制id， 用Date.now()
const newUser=(cov_ete167hvl.s[14]++,Object.assign({id:Date.now()},user));cov_ete167hvl.s[15]++;dbjson.users.push(newUser);// 把数据保存
cov_ete167hvl.s[16]++;_savejson(dbjson);cov_ete167hvl.s[17]++;return{msg:"save newUser to dbjson successfully",code:1};};function _savejson(jsonData){cov_ete167hvl.f[3]++;const strJson=(cov_ete167hvl.s[18]++,JSON.stringify(jsonData));// 把一个对象转成json字符串
cov_ete167hvl.s[19]++;fs.writeFileSync(path.join(__dirname,"../db.json"),strJson,{encoding:"utf8"});}cov_ete167hvl.s[20]++;exports.delUser=function(id){cov_ete167hvl.f[4]++;cov_ete167hvl.s[21]++;console.log("---id:",id,typeof id);cov_ete167hvl.s[22]++;if((cov_ete167hvl.b[6][0]++,id>0)&&(cov_ete167hvl.b[6][1]++,typeof id=="number")){cov_ete167hvl.b[5][0]++;const idx=(cov_ete167hvl.s[23]++,dbjson.users.findIndex(u=>{cov_ete167hvl.f[5]++;cov_ete167hvl.s[24]++;return u.id==id;}));cov_ete167hvl.s[25]++;console.log("------idx:",idx);cov_ete167hvl.s[26]++;dbjson.users.splice(idx,1);cov_ete167hvl.s[27]++;_savejson(dbjson);cov_ete167hvl.s[28]++;return{code:1,msg:"del successfully"};}else{cov_ete167hvl.b[5][1]++;};cov_ete167hvl.s[29]++;return{code:0,msg:"del failed"};};